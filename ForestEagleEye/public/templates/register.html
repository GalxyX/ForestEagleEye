<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>注册 - 林上鹰眼</title>
</head>
<body>
    <h1>注册</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul>
          {% for category, message in messages %}
            <li style="color: {% if category == 'error' %}red{% else %}green{% endif %};">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    <form method="post" action="{{ url_for('register') }}">
        <label>用户名：</label><input type="text" name="username" required><br>
        <label>邮箱：</label><input type="email" name="email" required><br>
        <label>密码：</label><input type="password" name="password" required><br>
        <label>验证码：</label><input type="text" name="code" required>
        <button type="button" onclick="sendCode()">发送验证码</button><br>
        <input type="submit" value="注册">
    </form>
    <p>已有账号？<a href="{{ url_for('login') }}">登录</a></p>
    <script>
        function sendCode() {
            const email = document.querySelector('input[name="email"]').value;
            if (!email) {
                alert('请先填写邮箱');
                return;
            }
            fetch('{{ url_for('send_verification_code') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'email=' + encodeURIComponent(email)
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => alert('发送验证码失败'));
        }
    </script>
</body>
</html>
