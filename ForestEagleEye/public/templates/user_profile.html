<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ user.u_name }}的主页</title>
    <style>
        .container {
            width: 80%;
            margin: 0 auto;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .back-button {
            margin-right: auto;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .profile-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .profile-header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 10px;
        }
        .profile-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .profile-tabs a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            padding: 5px 10px;
            border-bottom: 2px solid transparent;
        }
        .profile-tabs a.active {
            color: #28a745;
            border-bottom-color: #28a745;
        }
        .post {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        .post h3 {
            margin: 0;
            font-size: 1.2em;
            color: #333;
        }
        .post p {
            color: #555;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .post-images {
            display: flex;
            margin-top: 10px;
        }
        .post-images img {
            width: 80px;
            height: auto;
            margin-right: 5px;
            object-fit: cover;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <a href="{{ url_for('forum_home') }}" class="back-button">返回论坛首页</a>
    </div>

    <div class="profile-header">
        <img src="{{ url_for('static', filename=user.u_avatarPath) }}" alt="Avatar">
        <h2>{{ user.u_name }}</h2>
    </div>

    <div class="profile-tabs">
        <a href="{{ url_for('user_profile', username=user.u_name, tab='my_posts') }}" class="{{ 'active' if current_tab == 'my_posts' else '' }}">我的发布</a>
        <a href="{{ url_for('user_profile', username=user.u_name, tab='my_likes') }}" class="{{ 'active' if current_tab == 'my_likes' else '' }}">我的点赞</a>
        <a href="{{ url_for('user_profile', username=user.u_name, tab='my_favorites') }}" class="{{ 'active' if current_tab == 'my_favorites' else '' }}">我的转发</a>
    </div>

    <div class="posts">
        {% for post in posts %}
        <div class="post" data-post-id="{{ post.id }}">
            {% if post.original_post %}
                <h3>{{ post.author.username }} 转发了帖子:
                    <a href="{{ url_for('post_detail', post_id=post.original_post.id) }}">{{ post.original_post.title }}</a>
                </h3>
                <p>原作者: <a href="{{ url_for('user_profile', username=post.original_post.author.username) }}">{{ post.original_post.author.username }}</a></p>
            {% else %}
                <h3><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title }}</a></h3>
            {% endif %}

            <p>{{ post.content_preview }}</p>
            <div class="post-images">
                {% for image in post.images %}
                    <img src="{{ url_for('static', filename=image) }}" alt="Post Image">
                {% endfor %}
            </div>
            <div class="post-actions">
                <button onclick="toggleLike({{ post.id }})" class="like-button">
                    {{ "👎 取消点赞" if post.is_liked else "👍 点赞" }}
                </button>
                <span class="like-count">{{ post.like_count }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>

    function toggleLike(postId) {
        fetch(`/post/${postId}/like`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("点赞操作失败：" + data.error);
                    return;
                }
                document.querySelectorAll(`[data-post-id="${postId}"] .like-button`).forEach(button => {
                    button.textContent = data.action === 'liked' ? '👎 取消点赞' : '👍 点赞';
                });
                document.querySelectorAll(`[data-post-id="${postId}"] .like-count`).forEach(span => {
                    span.textContent = data.like_count;
                });
            })
            .catch(error => console.error("点赞操作失败:", error));
    }
</script>
</body>
</html>
